<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:dtos="clr-namespace:CatDex.Models.DTOs"
             xmlns:viewmodels="clr-namespace:CatDex.ViewModels"
             x:Class="CatDex.Views.DiscoverPage"
             x:DataType="viewmodels:CatDiscoveryViewModel"
             Title="DiscoverPage">

    <CollectionView 
        x:Name="CatsCollectionView"
        ItemsSource="{Binding Cats}"
        Scrolled="OnCollectionViewScrolled"
        RemainingItemsThreshold="5"
        RemainingItemsThresholdReachedCommand="{Binding ThresholdReachedCommand}"
        VerticalScrollBarVisibility="Never">

        <CollectionView.ItemsLayout>
            <LinearItemsLayout 
                Orientation="Vertical" 
                SnapPointsType="MandatorySingle" 
                SnapPointsAlignment="Start" />
        </CollectionView.ItemsLayout>

        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="dtos:CatDTO">
                <Grid HeightRequest="{Binding Height, Source={RelativeSource AncestorType={x:Type CollectionView}}}">
                    <Image 
                        Source="{Binding Url}" 
                        Aspect="AspectFill" 
                        HorizontalOptions="Fill" 
                        VerticalOptions="Fill" />

                    <VerticalStackLayout 
                        VerticalOptions="End" 
                        Padding="20">
                        <Label Text="{Binding Id, StringFormat='Cat ID: {0}'}" TextColor="White" FontSize="18" />
                    </VerticalStackLayout>
                </Grid>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>

</ContentPage>