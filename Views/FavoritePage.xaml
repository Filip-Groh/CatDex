<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:CatDex.Models"
             xmlns:viewmodels="clr-namespace:CatDex.ViewModels"
             xmlns:controls="clr-namespace:CatDex.Controls"
             x:Class="CatDex.Views.FavoritePage"
             x:DataType="viewmodels:FavoriteViewModel">

    <Grid RowDefinitions="Auto,Auto,*">
        <ActivityIndicator IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           Grid.Row="0"
                           Margin="0,10,0,10"/>

        <Grid Grid.Row="1"
              Margin="8,0,8,8"
              ColumnDefinitions="*,Auto">
            <Picker ItemsSource="{Binding Breeds}"
                    SelectedItem="{Binding SelectedBreed}"
                    ItemDisplayBinding="{Binding Name}"
                    Title="Filter by Breed"
                    Grid.Column="0"
                    VerticalOptions="Center"/>

            <Border Grid.Column="1"
                    StrokeThickness="0"
                    Padding="2"
                    HeightRequest="40"
                    VerticalOptions="Center">
                <Border.BackgroundColor>
                    <AppThemeBinding Light="White" Dark="Transparent" />
                </Border.BackgroundColor>
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="6"/>
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="2">
                    <Button Command="{Binding ToggleDisplayModeCommand}"
                            ImageSource="grid.svg"
                            WidthRequest="36"
                            HeightRequest="36"
                            CornerRadius="4"
                            Padding="6">
                        <Button.BackgroundColor>
                            <AppThemeBinding Light="White" Dark="Transparent" />
                        </Button.BackgroundColor>
                        <Button.Triggers>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding IsListMode}"
                                         Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </DataTrigger>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding IsListMode}"
                                         Value="True">
                                <Setter Property="Opacity" Value="0.3"/>
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>
                    <Button Command="{Binding ToggleDisplayModeCommand}"
                            ImageSource="list.svg"
                            WidthRequest="36"
                            HeightRequest="36"
                            CornerRadius="4"
                            Padding="6">
                        <Button.BackgroundColor>
                            <AppThemeBinding Light="White" Dark="Transparent" />
                        </Button.BackgroundColor>
                        <Button.Triggers>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding IsListMode}"
                                         Value="True">
                                <Setter Property="Opacity" Value="0.6"/>
                            </DataTrigger>
                            <DataTrigger TargetType="Button"
                                         Binding="{Binding IsListMode}"
                                         Value="False">
                                <Setter Property="Opacity" Value="0.3"/>
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>
                </HorizontalStackLayout>
            </Border>
        </Grid>

        <RefreshView IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}"
                     Grid.Row="2"
                     Margin="8,0">
            <CollectionView ItemsSource="{Binding Cats}"
                            SelectionMode="None">

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                     Span="2" 
                                     HorizontalItemSpacing="8"
                                     VerticalItemSpacing="8"
                                     x:Name="gridLayout"/>
                </CollectionView.ItemsLayout>

                <CollectionView.Triggers>
                    <DataTrigger TargetType="CollectionView"
                                 Binding="{Binding IsListMode}"
                                 Value="True">
                        <Setter Property="ItemsLayout">
                            <Setter.Value>
                                <LinearItemsLayout Orientation="Vertical" 
                                                   ItemSpacing="8"/>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                </CollectionView.Triggers>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Cat">
                        <controls:CatCard ToggleFavoriteCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoriteViewModel}}, Path=ToggleFavoriteCommand}"
                                          TappedCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoriteViewModel}}, Path=NavigateToCatDetailsCommand}"
                                          DeleteCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoriteViewModel}}, Path=DeleteCatCommand}"
                                          IsListMode="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoriteViewModel}}, Path=IsListMode}"/>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <ContentView>
                        <VerticalStackLayout HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             Padding="20">
                            <Label Text="No favorite cats found"
                                   FontSize="16"
                                   HorizontalOptions="Center"
                                   TextColor="Gray"/>
                        </VerticalStackLayout>
                    </ContentView>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>