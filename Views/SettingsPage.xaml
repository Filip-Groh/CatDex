<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:CatDex.ViewModels"
             x:Class="CatDex.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel">

    <RefreshView IsRefreshing="{Binding IsRefreshing}"
                 Command="{Binding RefreshCommand}">
        <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <Label 
                Text="Appearance"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center" 
                Margin="0,0,0,10"/>

            <Border 
                StrokeThickness="1"
                Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                StrokeShape="RoundRectangle 10"
                Padding="15"
                Margin="0,0,0,10">
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="Theme"
                        FontSize="16"
                        FontAttributes="Bold"/>
                    <Picker 
                        ItemsSource="{Binding ThemeOptions}"
                        SelectedItem="{Binding SelectedTheme}"
                        Title="Select Theme"
                        FontSize="16"/>
                </VerticalStackLayout>
            </Border>

            <Label 
                Text="Image Caching"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center" 
                Margin="0,0,0,10"/>

            <Border 
                StrokeThickness="1"
                Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                StrokeShape="RoundRectangle 10"
                Padding="15"
                Margin="0,0,0,10">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                        <Label 
                            Text="Favorites Only"
                            FontSize="16"
                            VerticalOptions="Center"/>
                        <Switch 
                            IsToggled="{Binding CacheAllImages}"
                            VerticalOptions="Center"/>
                        <Label 
                            Text="All Images"
                            FontSize="16"
                            VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <VerticalStackLayout 
                        Spacing="5" 
                        IsVisible="{Binding IsCaching}"
                        Margin="0,10,0,0">
                        <Label 
                            FontSize="14"
                            HorizontalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="Caching images: "/>
                                    <Span Text="{Binding CachingProgress}"/>
                                    <Span Text=" / "/>
                                    <Span Text="{Binding CachingTotal}"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <ProgressBar 
                            Progress="{Binding CachingProgressRatio}"
                            ProgressColor="{StaticResource Primary}"
                            HeightRequest="8"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <Label 
                Text="Database Statistics"
                FontSize="24"
                FontAttributes="Bold"
                HorizontalOptions="Center" 
                Margin="0,0,0,10"/>

            <ActivityIndicator 
                IsRunning="{Binding IsBusy}"
                IsVisible="{Binding IsBusy}"
                HorizontalOptions="Center"
                VerticalOptions="Center" />

            <VerticalStackLayout Spacing="15" IsVisible="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">
                <Border 
                    StrokeThickness="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
                    <VerticalStackLayout Spacing="5">
                        <Label 
                            Text="Total Cats"
                            FontSize="16"
                            FontAttributes="Bold"/>
                        <Label 
                            Text="{Binding TotalCats}"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border 
                    StrokeThickness="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
                    <VerticalStackLayout Spacing="5">
                        <Label 
                            Text="Favorite Cats"
                            FontSize="16"
                            FontAttributes="Bold"/>
                        <Label 
                            Text="{Binding FavoriteCats}"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border 
                    StrokeThickness="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
                    <VerticalStackLayout Spacing="5">
                        <Label 
                            Text="Created Cats"
                            FontSize="16"
                            FontAttributes="Bold"/>
                        <Label 
                            Text="{Binding CreatedCats}"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border 
                    StrokeThickness="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
                    <VerticalStackLayout Spacing="5">
                        <Label 
                            Text="Total Stored Images"
                            FontSize="16"
                            FontAttributes="Bold"/>
                        <Label 
                            Text="{Binding TotalStoredImages}"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border 
                    StrokeThickness="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
                    <VerticalStackLayout Spacing="5">
                        <Label 
                            Text="User Created Images"
                            FontSize="16"
                            FontAttributes="Bold"/>
                        <Label 
                            Text="{Binding UserCreatedImages}"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Border 
                    StrokeThickness="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeShape="RoundRectangle 10"
                    Padding="15"
                    Margin="0,0,0,10">
                    <VerticalStackLayout Spacing="5">
                        <Label 
                            Text="Cached Images"
                            FontSize="16"
                            FontAttributes="Bold"/>
                        <Label 
                            Text="{Binding CachedImages}"
                            FontSize="32"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>

                <Button 
                    Text="Delete Non-Created and Non-Favorite Cats"
                    Command="{Binding DeleteNonCreatedNonFavoriteCommand}"
                    BackgroundColor="#DC3545"
                    TextColor="White"
                    FontAttributes="Bold"
                    Margin="0,10,0,20"/>
            </VerticalStackLayout>
        </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
